<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</title>
  <style>
    body {
      background-color: #111;
      color: white;
      font-family: sans-serif;
      padding: 20px;
      min-height: 100vh;
      direction: rtl;
      position: relative;
    }
    h1 {
      text-align: center;
      margin-bottom: 15px;
    }
    .day {
      border-radius: 12px;
      background-color: #222;
      margin-bottom: 25px;
      padding: 15px 20px;
      box-shadow: 0 0 15px #000;
    }
    .day-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .day-header h3 {
      margin: 0;
    }
    .day-summary {
      color: #aaa;
      margin-bottom: 10px;
    }
    .products-list {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    .product-box {
      flex: 1 1 220px;
      background-color: #333;
      border-radius: 10px;
      padding: 12px 15px;
      box-shadow: 0 0 8px #000;
      position: relative;
      color: white;
    }
    .product-box.red {
      background-color: #8b0000;
    }
    .product-box.blue {
      background-color: #004080;
    }
    .product-box h4 {
      margin: 0 0 8px 0;
      font-size: 18px;
    }
    .product-info {
      font-size: 14px;
      line-height: 1.4;
      white-space: pre-line;
      margin-bottom: 10px;
    }
    .btn-group {
      display: flex;
      gap: 10px;
      justify-content: flex-start;
    }
    button {
      border: none;
      padding: 6px 10px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      color: white;
      transition: background-color 0.3s;
      user-select: none;
    }
    .btn-delete {
      background-color: crimson;
    }
    .btn-delete:hover {
      background-color: #b30000;
    }
    .btn-edit {
      background-color: #008080;
    }
    .btn-edit:hover {
      background-color: #006666;
    }
    #menuBtn {
      position: fixed;
      top: 20px;
      left: 20px;
      background: none;
      border: none;
      font-size: 28px;
      color: white;
      cursor: pointer;
      z-index: 1000;
      user-select: none;
      outline: none;
      padding: 0;
    }
    #dropdownMenu {
      display: none;
      position: fixed;
      top: 60px;
      left: 20px;
      background-color: #222;
      border-radius: 10px;
      box-shadow: 0 0 10px #000;
      width: 180px;
      z-index: 999;
      user-select: none;
    }
    #dropdownMenu a {
      display: block;
      color: white;
      padding: 12px 15px;
      text-decoration: none;
      border-bottom: 1px solid #444;
      font-size: 16px;
      transition: background-color 0.2s;
    }
    #dropdownMenu a:last-child {
      border-bottom: none;
    }
    #dropdownMenu a:hover {
      background-color: #444;
    }
    #exportAllPDFBtn {
      background-color: #0066cc;
      border: none;
      color: white;
      padding: 10px 15px;
      font-size: 16px;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 0 8px #005bb5;
      margin: 10px auto 30px auto;
      display: block;
      width: max-content;
      transition: background-color 0.3s;
      user-select: none;
    }
    #exportAllPDFBtn:hover {
      background-color: #004d99;
    }
  </style>
</head>
<body>

  <button id="menuBtn">â‹®</button>
  <div id="dropdownMenu">
    <a href="index.html">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a href="products.html">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª</a>
    <a href="#" id="closeMenu">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</a>
  </div>

  <h1>ğŸ“… Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h1>

  <button id="exportAllPDFBtn">â¬‡ï¸ ØªØµØ¯ÙŠØ± ÙƒÙ„ Ø§Ù„Ø£ÙŠØ§Ù… ÙƒÙ…Ù„Ù PDF</button>

  <div id="salesContainer"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    const { jsPDF } = window.jspdf;
    const salesContainer = document.getElementById("salesContainer");
    const exportAllPDFBtn = document.getElementById("exportAllPDFBtn");

    let salesData = [];

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage
    function loadSales() {
      salesData = [];
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith("sales-")) {
          const day = key.replace("sales-", "");
          const data = JSON.parse(localStorage.getItem(key));
          salesData.push({ day, data });
        }
      }
      // ØªØ±ØªÙŠØ¨ Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ù„Ù„Ø£Ù‚Ø¯Ù…
      salesData.sort((a, b) => b.day.localeCompare(a.day));
    }

    function saveSalesDay(day, data) {
      localStorage.setItem("sales-" + day, JSON.stringify(data));
    }

    function deleteDay(day) {
      if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù„ÙŠÙˆÙ… ${day}ØŸ`)) return;
      localStorage.removeItem("sales-" + day);
      loadSales();
      renderSales();
    }

    function deleteProduct(day, index) {
      if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ")) return;
      let dayData = salesData.find(s => s.day === day).data;
      dayData.splice(index, 1);
      saveSalesDay(day, dayData);
      loadSales();
      renderSales();
    }

    function editProduct(day, index) {
      let dayData = salesData.find(s => s.day === day).data;
      let item = dayData[index];

      const newQuantity = prompt("ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙ…ÙŠØ©:", item.quantity);
      if (newQuantity === null) return;

      let quantityNum = parseInt(newQuantity);
      if (isNaN(quantityNum) || quantityNum <= 0) {
        alert("Ø§Ù„ÙƒÙ…ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
        return;
      }

      const newSellPrice = prompt("ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ù„.Ø³):", item.sellPrice);
      if (newSellPrice === null) return;

      let sellPriceNum = parseFloat(newSellPrice);
      if (isNaN(sellPriceNum) || sellPriceNum < 0) {
        alert("Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ ØºÙŠØ± ØµØ­ÙŠØ­");
        return;
      }

      item.quantity = quantityNum;
      item.sellPrice = sellPriceNum;

      // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¨Ø­ Ø­Ø³Ø¨ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Ø¥Ø°Ø§ ÙÙŠÙ‡ Ø³Ø¹Ø± Ø´Ø±Ø§Ø¡ Ù…ØªÙˆÙØ±)
      let profit = sellPriceNum;
      if (item.costPrice) {
        profit = sellPriceNum - (item.costPrice * quantityNum);
      }
      item.profit = profit;

      saveSalesDay(day, dayData);
      loadSales();
      renderSales();
    }

    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª (Ù…Ø«Ù„Ø§Ù‹: 14:32)
    function formatTime(time) {
      return time || "";
    }

    function renderSales() {
      salesContainer.innerHTML = "";
      salesData.forEach(({ day, data }, dayIndex) => {
        let totalProfit = 0;
        let totalSales = data.length;

        data.forEach(item => {
          totalProfit += parseFloat(item.profit ?? (item.sellPrice - (item.costPrice * item.quantity)));
        });

        const dayDiv = document.createElement("div");
        dayDiv.className = "day";

        const dayHeader = document.createElement("div");
        dayHeader.className = "day-header";

        const dayTitle = document.createElement("h3");
        dayTitle.textContent = `ğŸ“† ${day}`;

        const dayBtns = document.createElement("div");

        const deleteDayBtn = document.createElement("button");
        deleteDayBtn.className = "btn-delete";
        deleteDayBtn.textContent = "ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙŠÙˆÙ…";
        deleteDayBtn.onclick = () => deleteDay(day);

        dayBtns.appendChild(deleteDayBtn);
        dayHeader.appendChild(dayTitle);
        dayHeader.appendChild(dayBtns);

        const summaryDiv = document.createElement("div");
        summaryDiv.className = "day-summary";
        summaryDiv.textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: ${totalSales} â€” Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ÙƒÙ„ÙŠ: ${totalProfit.toFixed(0)} Ù„.Ø³`;

        const productsList = document.createElement("div");
        productsList.className = "products-list";

        data.forEach((item, index) => {
          const productBox = document.createElement("div");
          productBox.className = "product-box " + (index % 2 === 0 ? "red" : "blue");

          const productTitle = document.createElement("h4");
          productTitle.textContent = item.product;
          productBox.appendChild(productTitle);

          const info = document.createElement("div");
          info.className = "product-info";
          info.textContent =
            `ğŸ”¢ Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.quantity}\n` +
            `ğŸ’° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${item.sellPrice} Ù„.Ø³\n` +
            `ğŸ’µ Ø§Ù„Ø±Ø¨Ø­: ${parseFloat(item.profit ?? (item.sellPrice - (item.costPrice * item.quantity))).toFixed(0)} Ù„.Ø³\n` +
            `ğŸ•’ Ø§Ù„ÙˆÙ‚Øª: ${formatTime(item.time)}`;
          productBox.appendChild(info);

          const btnGroup = document.createElement("div");
          btnGroup.className = "btn-group";

          const btnEdit = document.createElement("button");
          btnEdit.className = "btn-edit";
          btnEdit.textContent = "âœï¸ ØªØ¹Ø¯ÙŠÙ„";
          btnEdit.onclick = () => editProduct(day, index);

          const btnDelete = document.createElement("button");
          btnDelete.className = "btn-delete";
          btnDelete.textContent = "ğŸ—‘ï¸ Ø­Ø°Ù";
          btnDelete.onclick = () => deleteProduct(day, index);

          btnGroup.appendChild(btnEdit);
          btnGroup.appendChild(btnDelete);

          productBox.appendChild(btnGroup);
          productsList.appendChild(productBox);
        });

        dayDiv.appendChild(dayHeader);
        dayDiv.appendChild(summaryDiv);
        dayDiv.appendChild(productsList);

        // Ø²Ø± ØªØµØ¯ÙŠØ±

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>تسجيل المبيعات وتعديل الأسعار</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #fafafa;
        margin: 20px;
        color: #222;
    }
    h2 {
        margin-top: 40px;
        border-bottom: 2px solid #4CAF50;
        padding-bottom: 5px;
    }
    .container {
        max-width: 700px;
        margin: auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    label {
        display: block;
        margin: 15px 0 5px;
    }
    select, input[type=number], input[type=text] {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
    }
    button {
        margin-top: 15px;
        padding: 12px 20px;
        font-size: 16px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
    }
    button:hover {
        background-color: #45a049;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 25px;
    }
    th, td {
        padding: 10px;
        border: 1px solid #ddd;
        text-align: center;
    }
    .flex-row {
        display: flex;
        gap: 15px;
    }
    .flex-child {
        flex: 1;
    }
    .error {
        color: red;
        margin-top: 10px;
    }
</style>
</head>
<body>

<div class="container">

    <h2>تعديل أسعار وإضافة أغراض جديدة</h2>
    <label for="productNameInput">اسم المنتج:</label>
    <input type="text" id="productNameInput" placeholder="مثلاً: جرابات رجالي" />

    <label for="productPriceInput">السعر الأساسي (للوحدة):</label>
    <input type="number" id="productPriceInput" placeholder="مثلاً: 6000" min="1" />

    <button onclick="addOrUpdateProduct()">أضف أو عدل المنتج</button>
    <div id="productMsg" class="error"></div>

    <h2>تسجيل مبيعات اليوم</h2>
    <label for="productSelect">اختر المنتج:</label>
    <select id="productSelect">
        <!-- المنتجات تتحمل ديناميكياً -->
    </select>

    <div class="flex-row">
        <div class="flex-child">
            <label for="quantityInput">عدد القطع:</label>
            <input type="number" id="quantityInput" min="1" placeholder="مثلاً: 3" />
        </div>
        <div class="flex-child">
            <label for="totalPriceInput">السعر الإجمالي (البيع):</label>
            <input type="number" id="totalPriceInput" min="1" placeholder="مثلاً: 18000" />
        </div>
    </div>

    <button onclick="addSale()">أضف المبيع</button>
    <div id="saleMsg" class="error"></div>

    <h2>سجل المبيعات</h2>
    <table id="salesTable">
        <thead>
            <tr>
                <th>المنتج</th>
                <th>عدد القطع</th>
                <th>السعر الإجمالي</th>
                <th>الربح</th>
                <th>التاريخ</th>
            </tr>
        </thead>
        <tbody>
            <!-- سجل المبيعات يظهر هنا -->
        </tbody>
    </table>

    <button onclick="clearSales()" style="margin-top:20px; background:#d9534f;">حذف كل المبيعات</button>
</div>

<script>
    // جلب بيانات المنتجات من localStorage أو إستخدام البيانات الافتراضية
    let products = JSON.parse(localStorage.getItem('products')) || {
        "كولون": 6500,
        "جرابات وسط": 2500,
        "جرابات ثقيل": 3000,
        "خف": 2500,
        "بوكسر محير": 6000,
        "لحمي قصير": 2500,
        "لحمي طويل": 3500,
        "كشكش": 3000,
        "ايميلي": 9500,
        "زنود": 6000,
        "شيال": 10000,
        "شيال رياضي": 11000,
        "طقم ولادي": 8000,
        "بوكسر رجالي": 8300,
        "بكلة فراشة": 5000,
        "مطاط": 2000,
        "عطر": 5000
    };

    // جلب بيانات المبيعات
    let sales = JSON.parse(localStorage.getItem('sales')) || [];

    // تحديث قائمة المنتجات في select
    function updateProductSelect() {
        const select = document.getElementById('productSelect');
        select.innerHTML = '';
        for (const [name, price] of Object.entries(products)) {
            let option = document.createElement('option');
            option.value = name;
            option.textContent = `${name} - السعر الأساسي: ${price}`;
            select.appendChild(option);
        }
    }

    // إضافة أو تعديل منتج
    function addOrUpdateProduct() {
        const nameInput = document.getElementById('productNameInput');
        const priceInput = document.getElementById('productPriceInput');
        const msg = document.getElementById('productMsg');

        const name = nameInput.value.trim();
        const price = Number(priceInput.value);

        if (!name) {
            msg.textContent = 'يرجى إدخال اسم المنتج';
            return;
        }
        if (!price || price <= 0) {
            msg.textContent = 'يرجى إدخال سعر صحيح أكبر من صفر';
            return;
        }

        products[name] = price; // أضف أو عدل المنتج
        localStorage.setItem('products', JSON.stringify(products));
        msg.textContent = 'تمت الإضافة/التعديل بنجاح!';
        nameInput.value = '';
        priceInput.value = '';

        updateProductSelect();
    }

    // إضافة مبيع
    function addSale() {
        const saleMsg = document.getElementById('saleMsg');
        saleMsg.textContent = '';

        const product = document.getElementById('productSelect').value;
        const quantity = Number(document.getElementById('quantityInput').value);
        const totalPrice = Number(document.getElementById('totalPriceInput').value);

        if (!product) {
            saleMsg.textContent = 'اختر المنتج من القائمة';
            return;
        }
        if (!quantity || quantity <= 0) {
            saleMsg.textContent = 'أدخل عدد قطع صحيح أكبر من صفر';
            return;
        }
        if (!totalPrice || totalPrice <= 0) {
            saleMsg.textContent = 'أدخل سعر بيع إجمالي صحيح';
            return;
        }

        // حساب الربح
        const costPrice = products[product];
        const profit = totalPrice - (costPrice * quantity);

        // تخزين المبيع
        sales.push({
            product,
            quantity,
            totalPrice,
            profit,
            date: new Date().toLocaleDateString()
        });
        localStorage.setItem('sales', JSON.stringify(sales));

        displaySales();

        // إعادة تعيين الحقول
        document.getElementById('quantityInput').value = '';
        document.getElementById('totalPriceInput').value = '';
    }

    // عرض المبيعات في الجدول
    function displaySales() {
        const tbody = document.querySelector('#salesTable tbody');
        tbody.innerHTML = '';
        sales.forEach(sale => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${sale.product}</td>
                <td>${sale.quantity}</td>
                <td>${sale.totalPrice}</td>
                <td>${sale.profit}</td>
                <td>${sale.date}</td>
            `;
            tbody.appendChild(tr);
        });
    }

    // حذف
